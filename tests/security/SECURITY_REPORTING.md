# Security Test Reporting System

## Overview

The security test reporting system provides comprehensive, actionable reports for security vulnerabilities discovered during testing. Each test now generates detailed reports including:

- **Test Status**: PASS, FAIL, SKIP, or WARNING
- **Risk Level**: CRITICAL, HIGH, MEDIUM, LOW, or INFO
- **OWASP Category**: References to OWASP API Security Top 10
- **Detailed Recommendations**: Specific actions to remediate vulnerabilities
- **Remediation Steps**: Step-by-step instructions for fixing issues
- **References**: Links to OWASP documentation and best practices

## Report Format

### When a Test Passes âœ…

```markdown
# Security Test Report

## âœ… Test Result: PASS

**Test:** Mass assignment: creating user should not allow isAdmin=true
**Timestamp:** 2025-10-22T15:41:23.456Z
**OWASP Category:** API6:2023 - Unrestricted Access to Sensitive Business Flows

## Description

Mass assignment protection verified: API correctly rejected or ignored isAdmin=true parameter

---
*Generated by Security Test Reporter*
```

### When a Test Fails âŒ

```markdown
# Security Test Report

## âŒ Test Result: FAIL

**Test:** Excessive Data Exposure: GET user should not return sensitive fields (password)
**Timestamp:** 2025-10-22T15:41:25.789Z
**OWASP Category:** API3:2023 - Broken Object Property Level Authorization
**Risk Level:** ðŸŸ  HIGH

## Description

APIs tend to expose sensitive object properties without proper filtering, leading to excessive data exposure.

## âš ï¸ Vulnerability Detected

API3:2023 - Broken Object Property Level Authorization

## Evidence

```json
{
  "endpoint": "/api/users/123",
  "exposedFields": {
    "password": false,
    "passwordHash": true
  },
  "issue": "Sensitive password fields exposed in API response"
}
```

## ðŸ“‹ Recommendations

1. Never include sensitive fields in API responses (passwords, tokens, etc.)
2. Implement response filtering based on user permissions
3. Use Data Transfer Objects (DTOs) to control exposed fields
4. Validate and sanitize all API responses
5. Document what data should be exposed for each endpoint

## ðŸ”§ Remediation Steps

1. Audit all API responses for sensitive data exposure
2. Create serializers/DTOs that explicitly define allowed fields
3. Remove password hashes, tokens, and internal IDs from responses
4. Implement field-level authorization checks
5. Add automated tests to detect sensitive data in responses
6. Use allow-lists instead of block-lists for field exposure

## ðŸ“š References

- https://owasp.org/API-Security/editions/2023/en/0xa3-broken-object-property-level-authorization/
- https://cheatsheetseries.owasp.org/cheatsheets/Mass_Assignment_Cheat_Sheet.html

---
*Generated by Security Test Reporter*
```

### When a Test Generates a Warning âš ï¸

```markdown
# Security Test Report

## âš ï¸ Test Result: WARNING

**Test:** Rate limiting / DoS protections: small burst should reveal 429 or rate headers if in place
**Timestamp:** 2025-10-22T15:41:27.123Z
**OWASP Category:** API4:2023 - Unrestricted Resource Consumption
**Risk Level:** ðŸŸ¢ LOW

## Description

No rate limiting detected during burst test (30 requests). This may indicate lack of DoS protection.

## ðŸ“‹ Recommendations

1. Consider implementing rate limiting to prevent abuse
2. Use middleware like express-rate-limit or similar
3. Return 429 status code when limits exceeded
4. Add rate limit headers (X-RateLimit-*) to responses

---
*Generated by Security Test Reporter*
```

### When a Test is Skipped â­ï¸

```markdown
# Security Test Report

## â­ï¸ Test Result: SKIP

**Test:** Mass assignment: creating user should not allow isAdmin=true
**Timestamp:** 2025-10-22T15:41:28.456Z
**OWASP Category:** N/A

## Description

Test skipped: No user-create endpoint found to test mass assignment

---
*Generated by Security Test Reporter*
```

## Risk Levels

| Level | Icon | Description | Urgency |
|-------|------|-------------|---------|
| **CRITICAL** | ðŸ”´ | Immediate security threat requiring urgent action | Fix within 24 hours |
| **HIGH** | ðŸŸ  | Significant security risk that should be addressed quickly | Fix within 1 week |
| **MEDIUM** | ðŸŸ¡ | Moderate security concern requiring attention | Fix within 1 month |
| **LOW** | ðŸŸ¢ | Minor security improvement or best practice | Address in next sprint |
| **INFO** | â„¹ï¸ | Informational finding for awareness | No immediate action required |

## OWASP API Security Top 10 Coverage

The reporting system covers all OWASP API Security Top 10 2023 categories:

1. **API1:2023** - Broken Object Level Authorization
2. **API2:2023** - Broken Authentication
3. **API3:2023** - Broken Object Property Level Authorization
4. **API4:2023** - Unrestricted Resource Consumption
5. **API5:2023** - Broken Function Level Authorization
6. **API6:2023** - Unrestricted Access to Sensitive Business Flows
7. **API7:2023** - Server Side Request Forgery
8. **API8:2023** - Security Misconfiguration
9. **API9:2023** - Improper Inventory Management
10. **API10:2023** - Unsafe Consumption of APIs

## Usage in Tests

### Basic Usage

```typescript
import { test } from '@playwright/test';
import { SecurityReporter, OWASP_VULNERABILITIES } from '../security-reporter';

test('My security test', async ({ baseURL }, testInfo) => {
  const reporter = new SecurityReporter(testInfo);
  
  // Report a passing test
  reporter.reportPass(
    'Security check passed successfully',
    OWASP_VULNERABILITIES.API1_BOLA.name
  );
});
```

### Reporting Vulnerabilities

```typescript
test('Check for data exposure', async ({ baseURL }, testInfo) => {
  const reporter = new SecurityReporter(testInfo);
  const api = await request.newContext({ baseURL });
  
  const response = await api.get('/api/users/123');
  const body = await response.json();
  
  if (body.password || body.passwordHash) {
    reporter.reportVulnerability('API3_DATA_EXPOSURE', {
      endpoint: '/api/users/123',
      exposedFields: {
        password: !!body.password,
        passwordHash: !!body.passwordHash
      }
    });
  }
});
```

### Reporting Warnings

```typescript
test('Check rate limiting', async ({ baseURL }, testInfo) => {
  const reporter = new SecurityReporter(testInfo);
  
  // Perform tests...
  
  if (!rateLimitDetected) {
    reporter.reportWarning(
      'No rate limiting detected',
      [
        'Implement rate limiting middleware',
        'Return 429 status code when limits exceeded',
        'Add rate limit headers to responses'
      ],
      OWASP_VULNERABILITIES.API4_RATE_LIMIT.name
    );
  }
});
```

### Reporting Skipped Tests

```typescript
test('Authorization test', async ({ baseURL }, testInfo) => {
  const reporter = new SecurityReporter(testInfo);
  
  if (!authEndpointFound) {
    reporter.reportSkip('No authentication endpoint found');
    test.skip(true, 'Cannot test without auth endpoint');
    return;
  }
});
```

## Viewing Reports

### In Playwright Test Results

Reports are automatically attached to test results and can be viewed in:

1. **Playwright HTML Reporter**: Reports appear as attachments in the test details
2. **Playwright Trace Viewer**: Download and view detailed traces with reports
3. **CI/CD Pipelines**: Reports are included in test artifacts

### Running Tests

```bash
# Run all security tests
npx playwright test tests/security/

# Run specific security test suite
npx playwright test tests/security/api-10/

# Generate HTML report
npx playwright test --reporter=html

# View the report
npx playwright show-report
```

### Example Command Output

```bash
$ npx playwright test tests/security/api-10/api-top10.spec.ts

Running 5 tests using 1 worker

  âœ“ [chromium] â€º api-10/api-top10.spec.ts:58:3 â€º Mass assignment: creating user should not allow isAdmin=true (2s)
  âœ“ [chromium] â€º api-10/api-top10.spec.ts:135:3 â€º Excessive Data Exposure: GET user should not return sensitive fields (1s)
  âœ“ [chromium] â€º api-10/api-top10.spec.ts:239:3 â€º Injection: basic SQL/command injection probe should not return server error (1s)
  âš  [chromium] â€º api-10/api-top10.spec.ts:314:3 â€º Rate limiting / DoS protections: small burst should reveal 429 or rate headers (2s)
  âš  [chromium] â€º api-10/api-top10.spec.ts:393:3 â€º Security headers and server fingerprinting (1s)

  5 passed (7s)
```

## Integration with CI/CD

### GitHub Actions Example

```yaml
name: Security Tests

on: [push, pull_request]

jobs:
  security:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Run security tests
        run: npx playwright test tests/security/
      
      - name: Upload test results
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: security-test-results
          path: |
            playwright-report/
            test-results/
```

## Best Practices

### For Test Writers

1. **Always use SecurityReporter**: Integrate it in all security tests for consistent reporting
2. **Provide Evidence**: Include relevant data that helps developers understand the issue
3. **Be Specific**: Use descriptive messages that clearly explain what was tested
4. **Choose Correct OWASP Category**: Map findings to the appropriate OWASP category
5. **Don't Over-Report**: Use SKIP for tests that can't run, not FAIL

### For Remediation

1. **Prioritize by Risk Level**: Address CRITICAL issues immediately, then HIGH, MEDIUM, LOW
2. **Follow Remediation Steps**: The provided steps are ordered for effective resolution
3. **Verify Fixes**: Re-run tests after implementing fixes to confirm resolution
4. **Document Changes**: Keep track of what was changed and why
5. **Learn from References**: Read the OWASP documentation for deeper understanding

## Customization

### Adding Custom OWASP Definitions

You can extend the `OWASP_VULNERABILITIES` object in `security-reporter.ts`:

```typescript
export const OWASP_VULNERABILITIES = {
  // ... existing definitions ...
  
  CUSTOM_VULN: {
    name: 'Custom Vulnerability',
    description: 'Description of the vulnerability',
    riskLevel: SecurityRiskLevel.HIGH,
    recommendations: [
      'Recommendation 1',
      'Recommendation 2'
    ],
    remediationSteps: [
      'Step 1',
      'Step 2'
    ],
    references: [
      'https://example.com/docs'
    ]
  }
};
```

### Custom Report Formatting

The `SecurityReporter` class can be extended for custom formatting:

```typescript
class CustomSecurityReporter extends SecurityReporter {
  private formatReport(result: SecurityTestResult): string {
    // Your custom formatting logic
    return customFormattedReport;
  }
}
```

## Troubleshooting

### Reports Not Appearing

- Ensure you're using `testInfo` parameter in your test function
- Check that reports are enabled in your Playwright config
- Verify the test completed (reports attach on completion)

### Missing OWASP References

- Update the `OWASP_VULNERABILITIES` object with latest OWASP links
- Ensure you're using the correct key when calling `reportVulnerability()`

### Duplicate Reports

- Each test should create only one `SecurityReporter` instance
- Don't call report methods multiple times for the same finding

## Support and Resources

- [OWASP API Security Project](https://owasp.org/www-project-api-security/)
- [OWASP Cheat Sheet Series](https://cheatsheetseries.owasp.org/)
- [Playwright Documentation](https://playwright.dev/)

---

**Last Updated**: October 22, 2025
**Version**: 1.0.0
